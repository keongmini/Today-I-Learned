# TCP/IP 4계층 모델
인터넷 프로토콜 스위트(Internet protocol suite): 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는 프로토콜의 집합     
-> TCP/IP 4계층 모델 or OSI 7계층 모델로 설명 가능

* TCP/IP 4계층 모델: 네트워크에서 사용되는 통신 프로토콜의 집합, 프로토콜의 네트워킹 범위에 따라 4개의 추상화 계층으로 구성

## 계층 구조

![image](https://github.com/keongmini/Today-I-Learned/assets/88446465/13af378b-93f5-4920-9a33-d188da235843)
출처: https://www.geeksforgeeks.org/tcp-ip-model/

> [OSI 계층과의 차이]    
> - 애플리케이션 계층을 3개로 분리
> - 링크 계층을 2개로 분리
> - 인터넷 계층 -> 네트워크 계층으로 명칭

각 계층은 특정 계층이 변경됐을 때 다른 계층이 영향을 받지 않도록 설계

1. 애플리케이션 계층     
   **FTP, HTTP, SSH, SMTP, DNS** 등 응용 프로그램이 사용되는 프로토콜 계층, 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 계층

   > FTP: 장치와 장치 간의 파일을 전송하는 데 사용되는 표준 통신 프로토콜       
   > SSH: 보안되지 않은 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜        
   > HTTP: World Wide Web을 위한 데이터 통신의 기초, 웹 사이트를 이용하는 데 쓰는 프로토콜        
   > SMTP: 전자 메일 전송을 위한 인터넷 표준 통신 프로토콜        
   > DNS: 도메인 이름과 IP 주소를 매핑해주는 서버     
   > ex) www.naver.com 에 DNS 쿼리 전달: [Root DNS] -> [.com DNS] -> [.naver DNS] -> [www DNS] 과정을 거쳐 IP 주소로 매핑
   > => IP 주소가 바껴도 사용자에게 같은 도메인 주소로 서비스 가능

2. 전송 계층     
   - 송신자와 수신자를 연결하는 통신 서비스 제공
   - 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어 제공 가능
   - 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때 중계 역할
   - TCP
     - 패킷 사이의 순서 보장
     - 연결지향 프로토콜을 사용해서 연결
     - 신뢰성을 구축해서 수신 여부 확인
     - '가상회선 패킷 교환 방식' 사용: 각 패킷에는 가상회선 식별자가 포함되며 모든 패킷을 전송하면 가상회선이 해제되고 패킷들은 전송된 순서대로 도착하는 방식
   - UDP
     - 순서 보장 x
     - 수신 여부 확인 x
     - 단순히 데이터만 주는 '데이터그램 패킷 교환 방식' 사용: 패캣이 독립적으로 이동하며 최적의 경로를 선택, 하나의 메시지에서 분할된 여러 패킷은 서로 다른 경로로 전송될 수 있고 순서대로 도착하지 않을 수 도 있는 방식

   > 패킷: 더 큰 메시지의 작은 세그먼트, 인터넷과 같은 컴퓨터 네트워크를 통해 전송되는 데이터는 패킷으로 분리됨
   > <img width="802" alt="스크린샷 2023-08-27 오전 8 45 00" src="https://github.com/keongmini/Today-I-Learned/assets/88446465/0ad105f6-3df7-4da9-9ad4-6320f6b4951e">
   > 출처: https://www.cloudflare.com/ko-kr/learning/network-layer/what-is-a-packet/

   [TCP 연결 성립 과정 - 3-way handshake]
   1. SYN 단계: 클라이언트는 ISN(새로운 TCP 연결의 첫번째 패킷에 할당된 임의의 시퀀스 번호, 장치마다 상이)을 담아 서버에 SYN 전송
   2. SYN + ACK 단계: 서버는 클라이언트이 SYN을 수신하고 서버의 ISN 전송, 승인번호로 클라이언트이 ISN + 1 전송
   3. ACK 단계: 클라이언트는 서버의 ISN + 1 값인 승인번호를 담아 서버에 전송
   
   > SYN: SYNchronization 연결 요청 플래그    
   > ACK: ACKnowledgement 응답 플래그    
   > ISN: Initial Sequence Numbers 초기 네트워크 연결을 할 때 할당된 32비트 고유 시퀀스 번호

   3웨이 핸드쉐이크 과정 이후 신뢰성 구축, 데이터 전송 시작
   > 이 과정을 진행하는 TCP는 신뢰성 있는 계층 <-> UDP는 이런 과정이 없어서 신뢰성이 없는 계층

   [TCP 연결 해제 과정 - 4-way handshake]
   1. 연결을 닫을 때 클라이언트가 FIN으로 설정된 세그먼트 전송, 클라이언트는 FIN_WAIT_1 상태로 들어가서 서버의 응답 대기
   2. 서버는 클라이언트로 ACK 승인 세그먼트 전송, CLOSE_WAIT 상태가 됨, 클라이언트가 세그먼트를 받으면 FIN_WAIT_2 상태가 됨
   3. 서버는 ACK 보내고 일정 시간 이후 클라이언트에 FIN 세그먼트 전송
   4. 클라이언트는 TIME_WAIT 상태가 된 후 다시 서버로 ACK를 보내서 서버는 CLOSED 상태가 됨, 클라이언트는 일정 시간 대기 후 연결이 닫히고 클라이언트와 서버의 모든 자원의 연결 해제

   * 일정 시간 이후 연결을 닫는 이유
     1. 지연 패킷이 발생할 경우 대비: 패킷이 뒤늦게 도달해서 처리하지 못하면 데이터 무결성 문제 발생
     2. 두 장치가 연결이 닫혔는지 확인용: 3단계에서 연결이 닫히게 되면 다시 새로운 연결을 할 때 장치는 LASK_ACK 상태이기 때문에 접속 오류 발생
     > TIME_WAIT: 소켓이 바로 소멸되지 않고 일정 시간 유지되는 상태, OS마다 상이     
     > 데이터  무결성: 데이터의 정확성과 일관성 유지하고 보증

3. 인터넷 계층
   - 장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층
   - IP, ARP, ICMP 등
   - 패킷을 수신해야 할 상대의 주소를 지정하여 데이터 전달
   - 상대방이 받았는지에 대해 보장하지 않는 비연결형적

4. 링크 계층
   - 전선, 광섬유, 무선 등으로 실질적으로 데이터를 전달, 장치 간에 신호를 주고받는 규칙을 정하는 계층 (네트워크 접근 계층)
   - 물리 계층: 무선 LAN, 유선 LAN을 통해 0과 1로 이루어진 데이터를 보내는 계층
     - 유선 LAN을 이루는 이더넷은 IEEE802.3 프로토콜을 따르고 전이중화 통신 사용
       > - 전이중화 통신: 양쪽 장치가 동시에 송수신할 수 있는 방식, 송신로와 수신로로 나눠서 데이터 주고 받음       
       > - CSMA/CD: 반이중화 통신 중 하나로 이전에 사용하던 방식, 데이터를 보낸 이후 충돌이 발생한다면 일정 시간 이후 재전송하는 방식, 송신로와 수신로를 따로 두지 않고 한 경로를 사용하기 때문에 데이터 전송시 충돌 발생 방지를 위해      
       > - 유선 LAN을 이루는 케이블 - TP 케이블: 트위스트 페어 케이블, 광섬유 케이블     
       >   - 트위스트 페어 케이블: 하나의 케이블처럼 보이지만 실제로는 8개의 구리선을 두개씩 꼬아서 묶은 케이블
       >   - 광섬유 케이블: 광섬유로 만든 케이블, 레이저를 이용해서 통신하기 때문에 장거리 및 고속 통신 가능
     - 무선 LAN: 수신과 송신에 같은 채널을 사용하기 때문에 반이중화 통신 사용
       > - 반이중화 통신: 양쪽 장치는 서로 통신할 수 있지만 동시네 통신 불가, 한번에 한 방향만 통신 가능한 방식
       > 
       > 일반적으로 장치가 신호를 수신하기 시작하면 응답하기 전에 전송 완료 전까지 대기 필요 - 둘 이상의 장치가 동시에 전송하면 충돌이 발생하여 메시지 손실되거나 왜곡될 수 있기 때문에 방지 충돌 방지 시스템 필요
       > 
       > - CSMA/CA: 반이중화 통신 중 하나, 장치에서 데이터를 보내기 전에 캐리어 감지 등으로 사전엥 가능한 한 충돌을 방지하는 방식 사용
       >   1. 데이터 송신 전 무선 매체 확인
       >   2. 캐리어 감지: 회선 비어있는지 확인
       >   3. IFS(Internet FrameSpace): 랜덤 값을 기반으로 정해진 시간만큼 대기, 만약 무선 매체 사용 중이면 간격 늘려가며 대기
       >   4. 데이터 송신
       >
       > - 무선 LAN: 무선 신호 전달 방식을 이용하여 2대 이상의 장치를 연결하는 기술
       >   - 와이파이: 전자기기들이 무선 LAN 신호에 연결할 수 있게 하는 기술, 무선 접속 장치(AP, 공유기) 필요, 유선 LAN에 흐르는 신호를 무선 신호로 바꿔주어 신호가 닿는 범위 내에 무선 인터넷 사용 가능
       >   - BSS(Basic Service Set): 기본 서비스 집합, 동일 BSS 내에 있는 AP들과 장치들이 서로 통신이 가능한 구조, 근거리 무선 통신 제공, 하나의 AP만으로 구축되기 때문에 자유롭게 이동하며 네트워크 접속을 불가
       >   - ESS(Extended Service Set): 하나 이상 연결된 BSS 그룹, 장거리 무선 통신 제공, BSS보다 더 많은 가용성과 이동성 지원
   - 데이터 링크 계층: '이더넷 프레임'을 통해 에러 확인, 흐름 제어, 접근 제어 담당하는 계층

[계층간 데이터 송수신 과정]     
= 데이터 요청시 발생하는 과정      
애플리케이션 계층에서 전송 계층으로 보내는 요청값들이 캡슐화 과정을 거쳐서 전달 -> 다시 링크 계층을 통해 해당 서버와 통신하고 서버의 링크 계층으로부터 애플리에이션까지 비캡슐화 과정을 거쳐 데이터 전송

- 캡슐화 과정: 상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입하는 과정       
  애플리케이션 계층의 데이터가 전송 계층으로 전달되면서 '세그먼트' 또는 '데이터그램'화되며 TCP(L4)헤더 붙음     
  -> 이후 인터넷 계층으로 가면서 IP(L3)헤더가 붙어서 '패킷'화 됨    
  -> 이후 링크 계층으로 전달되면서 프레임 헤더와 프레임 트레일러가 붙어 '프레임'화됨
- 비캡슐화 과정: 하위 계층에서 상위 계층으로 가며 각 계층의 헤더 부분을 제거하는 과정     
  캡슐화된 데이터를 받게 되면 링크 계층에서 부터 올라오면서 프레임화된 데이터 -> 패킷화 -> 세그먼트, 데이터그램화 -> 메시지화 -> 최종적으로 사용자에게 애플리케이션의 PDU인 메시지로 전달

## PDU(Protocol Data Unit)
네트워크의 어떠한 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위
- 헤더: 제어 관련 정보 포함
- 페이로드: 데이터

[계층별 명칭]
- 애플리케이션 계층: 메시지
- 전송 계층: 세그먼트(TCP), 데이터그램(UDP)
- 인터넷 계층: 패킷
- 링크 계층: 프레임(데이터 링크 계층), 비트(물리 계층)

> PDU 중 아래 계층인 비트로 송수신하는 것이 가장 빠르고 효율성이 좋지만 헤더에 authorization값 등 다른 값을 넣어 쉽게 확장할 수 있기 때문에 애플리케이션 계층에서는 문자열로 송수신
   
    
